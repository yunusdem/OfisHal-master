@model VohalCariKart

@{
    ViewBag.title = "Müstahsil Düzenle";

    ViewBag.pagetitle = "Müstahsil Cari";
    ViewBag.pagesubtitle = "Müstahsil";
    ViewBag.ptitle = "Müstahsil Düzenle";
    Layout = "~/Views/Shared/_Layout.cshtml";

    ViewBag.addUrl = "/TohalCariKarts/Create";
    ViewBag.saveUrl = "";
    ViewBag.searchUrl = "/Common/Carikartlar?target=null&tip=0&isNavigator=true";
    ViewBag.firstDataUrl = "/TohalCariKarts/ilkSonKayit?tip=0&firstOrLast=true";
    ViewBag.beforeDataUrl = "/TohalCariKarts/sonrakiOncekiKayit?tip=0&afterOrBefore=false&currentId=" + Model.CariKartId;
    ViewBag.afterDataUrl = "/TohalCariKarts/sonrakiOncekiKayit?tip=0&afterOrBefore=true&currentId=" + Model.CariKartId;
    ViewBag.lastDataUrl = "/TohalCariKarts/ilkSonKayit?tip=0&firstOrLast=false";
    ViewBag.disabledBeforeAfter = false;

    if(Model.VergiKimlikNo != null )
    {
        Model.VergiKimlikNo = Model.VergiKimlikNo.Trim();
    }
}
<style>
    .choices__inner {
        min-height: 0;
        font-size: .750rem;
    }

    .choices__list--single {
        padding: 0;
    }
</style>
@Html.Partial("~/Views/Shared/_dataNavigator.cshtml")
<form method="post" enctype="multipart/form-data" action="@Url.Action("Edit")">
    <input type="hidden" id="CariKartId" value="@Model.CariKartId" />
    @Html.AntiForgeryToken()
    <input type="hidden" name="Tip" value="0" />
    <div class="row">
        <div class="col-lg-5">
            <div class="row">
                <label for="Kod" class="col-sm-3 col-form-label pb-0">Kod</label>
                <div class="col-sm-9">
                    <input id="Kod" name="Kod" class="form-control form-control-sm" value="@Model.Kod" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.Kod)</span>
                </div>
            </div>
            <div class="row">
                <label for="Ad" class="col-sm-3 col-form-label pb-0">Ad</label>
                <div class="col-sm-9">
                    <input id="Ad" name="Ad" class="form-control form-control-sm" value="@Model.Ad" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.Ad)</span>
                </div>
            </div>
            <div class="row">
                <label for="GsmNo" class="col-sm-3 col-form-label pb-0">GSM No</label>
                <div class="col-sm-9">
                    <input id="GsmNo" name="GsmNo" class="form-control form-control-sm" value="@Model.GsmNo" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10)" />


                    <span class="text-danger">@Html.ValidationMessageFor(model => model.GsmNo)</span>
                </div>
            </div>
            <div class="row">
                <label for="EPosta" class="col-sm-3 col-form-label pb-0">EPosta</label>
                <div class="col-sm-9">
                    <input id="EPosta" name="EPosta" class="form-control form-control-sm" value="@Model.EPosta" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.EPosta)</span>
                </div>
            </div>
            <div class="row">
                <label for="Adres" class="col-sm-3 col-form-label pb-0">Adres</label>
                <div class="col-sm-9">
                    <input id="Adres" name="Adres" class="form-control form-control-sm" value="@Model.Adres" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.Adres)</span>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-3 col-form-label pb-0" for="il"> İl / İlçe</label>
                <div class="col-sm-9">
                    <div class="row">
                        <div class="col pe-0">
                            <div class="input-group">
                                <input type="hidden" name="IlId" id="IlId" value="@Model.IlId" />
                                <input type="text" id="il" name="il" class="form-control form-control-sm" data-id="@Model.IlId" value="@Model.IlAdi" />
                                <button type="button" data-btarget="il" id="ilBtn" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modal" data-label="Seç" data-remote-url="@Url.Action("Iller", "Common", new { target = "il", isInput = true })">
                                    Seç
                                </button>
                            </div>
                        </div>
                        <div class="col ps-1">
                            <div class="input-group">
                                <input type="hidden" name="IlceId" id="IlceId" value="@Model.IlceId" />
                                <input id="ilce" name="ilce" class="form-control form-control-sm" data-id="@Model.IlceId" value="@Model.IlceAdi" disabled />
                                <button disabled data-btarget="ilce" id="ilceBtn" type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modal" data-label="Seç" data-remote-url="@Url.Action("Iller", "Common", new { target = "ilce", isInput = true })">
                                    Seç
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <input type="hidden" name="BeldeId" id="BeldeId" value="@Model.BeldeId" />
                <label class="col-sm-3 col-form-label pb-0" for="belde"> Belde / Hal</label>
                <div class="col-sm-9">
                    <div class="row">
                        <div class="col pe-0">
                            <div class="input-group">
                                <input type="text" id="belde" name="belde" class="form-control form-control-sm" data-id="@Model.BeldeId" value="@Model.BeldeAdi" disabled />
                                <button disabled data-btarget="belde" type="button" id="beldeBtn" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modal" data-label="Seç" data-remote-url="@Url.Action("Iller", "Common", new { target = "belde", isInput = true })">
                                    Seç
                                </button>
                            </div>
                        </div>
                        <div class="col ps-1">
                            @*<select id="hal" name="hal" asp-for="HalId" class="form-select form-select-sm"  asp-items="ViewBag.HalId">
                            <option value=""></option>
                        </select>*@
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <input type="hidden" name="PostaKoduId" id="PostaKoduId" value="@Model.PostaKoduId" />
                <label class="col-sm-3 col-form-label pb-0" for="hidPostaKoduId">Posta Kodu</label>
                <div class="col-sm-9">
                    <div class="input-group">
                        <input type="text" id="hidPostaKoduId" name="hidPostaKoduId" class="form-control form-control-sm" data-id="@Model.PostaKoduId" value="@Model.PostaKodu" />
                        <button type="button" data-btarget="postakoduid" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modal" data-label="Seç" data-remote-url="@Url.Action("Maddeler", "Common", new { target = "hidPostaKoduId",tur = 0, isInput = true })">
                            Seç
                        </button>
                    </div>
                </div>
            </div>
            <div class="row">
                <label for="Tel1" class="col-sm-3 col-form-label pb-0">Tel1</label>
                <div class="col-sm-9">
                    <input id="Tel1" name="Tel1" class="form-control form-control-sm" value="@Model.Tel1" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10)" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.Tel1)</span>
                </div>
            </div>

            @*             <div class="row">
        <label asp-for="Tel2" class="col-sm-3 col-form-label pb-0"></label>
        <div class="col-sm-9">
        <input asp-for="Tel2" class="form-control form-control-sm" />
        <span class="text-danger">@Html.ValidationMessageFor(model => model.Tel2)</span>
        </div>
        </div>

        <div class="row">
        <label asp-for="Faks" class="col-sm-3 col-form-label pb-0"></label>
        <div class="col-sm-9">
        <input asp-for="Faks" class="form-control form-control-sm" />
        <span class="text-danger">@Html.ValidationMessageFor(model => model.Faks)</span>
        </div>
        </div> *@
            <div class="row mb-1">
                <label for="BankaHesapNo" class="col-sm-3 col-form-label pb-0">Banka Hesap No</label>
                <div class="col-sm-9">
                    <textarea id="BankaHesapNo" name="BankaHesapNo" class="form-control form-control-sm" rows="2" value="@Model.BankaHesapNo"></textarea>
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.BankaHesapNo)</span>
                </div>
            </div>
            @*             <div class="row">
        <label class="col-sm-3 col-form-label pb-0" asp-for="OrtakId"></label>
        <div class="col-sm-9">
        <div class="input-group">
        <input type="text" asp-for="OrtakId" id="OrtakId" name="OrtakId" class="form-control form-control-sm" />
        <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modal" data-label="Seç" data-remote-url="@Url.Action("ProducerNames", "Common", new { target = "OrtakId", tip = 0,isInput = true ,inputType = "name" })">
        Seç
        </button>
        </div>
        </div>
        </div>
        <div class="row">
        <label class="col-sm-3 col-form-label pb-0" asp-for="OrtaklikOrani"></label>
        <div class="col-sm-9">
        <input asp-for="OrtaklikOrani" name="OrtaklikOrani" id="OrtaklikOrani" value="0.00" placeholder="0.00" class="form-control form-control-sm numberFormat" maxlength="6" />
        </div>
        </div> *@
            <div class="row">
                <label class="col-sm-3 form-check-label" for="oranCheck">Komisyon Oranı</label>
                <div class="col-sm-9 d-flex align-items-center">
                    <input class="form-check-input me-1" type="checkbox" id="oranCheck" name="oranCheck" @(Model.Oran != null && Model.Oran > 0 ? "checked" : "")>
                    <input type="text" data-type="num" id="Oran" name="Oran" class="form-control form-control-sm" value="@Model.Oran.ToString()" @(Model.Oran == null || Model.Oran == 0 ? "disabled" : "")>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-3 form-check-label" for="reoranCheck">Reeskont Oranı</label>
                <div class="col-sm-9 d-flex align-items-center">
                    <input class="form-check-input me-1" type="checkbox" id="reoranCheck" name="reoranCheck" @(Model.ReeskontOrani != null && Model.ReeskontOrani > 0 ? "checked" : "")>
                    <input type="text" data-type="num" id="ReeskontOrani" name="ReeskontOrani" class="form-control form-control-sm" value="@Model.ReeskontOrani.ToString()" @(Model.ReeskontOrani == null || Model.ReeskontOrani == 0 ? "disabled" : "")>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-3 col-form-label pb-0" for="EFaturaBelgesi">eFatura Belgesi</label>
                <div class="col-sm-9">
                    <select class="form-select form-select-sm" name="EFaturaBelgesi" id="EFaturaBelgesi">
                        <option></option>
                        <option value="0" @(Model.EFaturaBelgesi == "0" ? "selected" : "")>eFatura</option>
                        <option value="1" @(Model.EFaturaBelgesi == "1" ? "selected" : "")>eFaturaDefault</option>
                        <option value="2" @(Model.EFaturaBelgesi == "2" ? "selected" : "")>MigrosHal_brmfiyat</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-3 col-form-label pb-0" for="Vade">Vade</label>
                <div class="col-sm-9">
                    <input type="number" data-type="num" value="@Model.Vade" name="Vade" id="Vade" class="form-control form-control-sm" />
                </div>
            </div>
        </div>
        <div class="col-lg-5">
            <div class="row">
                <div class="col d-flex justify-content-start">
                    <button type="button" class="btn btn-sm btn-secondary ms-1" id="gibKullaniciAlButton">Gib Kullanıcılarını Al</button>
                </div>
            </div>

            <div class="row">
                <label class="col-sm-3 col-form-label pb-0" for="KisilikTipi">Tipi</label>
                <div class="col-sm-9">
                    <select class="form-select form-select-sm" name="KisilikTipi" id="KisilikTipi" onchange="handleKisilikTipiChange()">
                        <option value="0" @(Model.KisilikTipi == 0 ? "selected" : "")>Şahıs</option>
                        <option value="1" @(Model.KisilikTipi == 1 ? "selected" : "")>Şahıs Firması</option>
                        <option value="2" @(Model.KisilikTipi == 2 ? "selected" : "")>Firma</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <label for="VergiKimlikNo" class="col-sm-3 col-form-label pb-0">TcVkn</label>
                <div class="col-sm-9">
                    <input id="VergiKimlikNo" name="VergiKimlikNo" type="number" class="form-control form-control-sm" value="@Model.VergiKimlikNo" style=" text-align: start; direction: unset;" oninput="handleCharacterCount()"/>
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.VergiKimlikNo)</span>
                </div>
            </div>
            @*             <div class="row">
        <label class="col-sm-3 col-form-label pb-0" asp-for="SehirId"></label>
        <div class="col-sm-9">
        <div class="input-group">
        <input asp-for="SehirId" id="SehirId" name="SehirId" class="form-control form-control-sm" />
        <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modal" data-label="Seç" data-remote-url="@Url.Action("Maddeler", "Common", new { target = "SehirId",tur = 1, isInput = true })">
        Seç
        </button>
        </div>
        </div>
        </div> *@
            <div class="row">
                <input type="hidden" id="VergiDairesiId" name="VergiDairesiId" value="@Model.VergiDairesiId" />
                <label class="col-sm-3 col-form-label pb-0" for="hidVergiDairesiId">Vergi Dairesi</label>
                <div class="col-sm-9">
                    <div class="input-group">
                        <input type="text" id="hidVergiDairesiId" name="hidVergiDairesiId" class="form-control form-control-sm" data-id="@Model.VergiDairesiId" value="@Model.VergiDairesiAdi" />
                        <button type="button" data-btarget="vergidairesiid" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modal" data-label="Seç" data-remote-url="@Url.Action("Maddeler", "Common", new { target = "hidVergiDairesiId",tur = 2, isInput = true })">
                            Seç
                        </button>
                    </div>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-4 col-form-label pb-0" for="MuafiyetBelgeNo">Muafiyet Belge No</label>
                <div class="col-sm-8">
                    <div class="row">
                        <div class="col pe-0">
                            <input type="text" name="MuafiyetBelgeNo" id="MuafiyetBelgeNo" asp-for="MuafiyetBelgeNo" class="form-control form-control-sm" value="@Model.MuafiyetBelgeNo" />
                        </div>
                        <div class="col ps-1">
                            <input type="date" asp-for="MuafiyetBitisTarihi" name="MuafiyetBitisTarihi" id="MuafiyetBitisTarihi" class="form-control form-control-sm" value="@Model.MuafiyetBitisTarihi?.ToString(" yyyy-MM-dd")" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <label for="BagkurNo" class="col-sm-3 col-form-label pb-0">Bağkur No</label>
                <div class="col-sm-9">
                    <input id="BagkurNo" name="BagkurNo" class="form-control form-control-sm" value="@Model.BagkurNo" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.BagkurNo)</span>
                </div>
            </div>
            <div class="row">
                <label for="BabaAdi" class="col-sm-3 col-form-label pb-0">Baba Adı</label>
                <div class="col-sm-9">
                    <input id="BabaAdi" name="BabaAdi" class="form-control form-control-sm" value="@Model.BabaAdi" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.BabaAdi)</span>
                </div>
            </div>
            <div class="row">
                <label for="Dogum" class="col-sm-3 col-form-label pb-0">Doğum</label>
                <div class="col-sm-9">
                    <input id="Dogum" name="Dogum" class="form-control form-control-sm" value="@Model.Dogum" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.Dogum)</span>
                </div>
            </div>
            <div class="row">
                <label for="BorsaSicilNo" class="col-sm-3 col-form-label pb-0">Borsa sicil</label>
                <div class="col-sm-9">
                    <input name="BorsaSicilNo" id="BorsaSicilNo" class="form-control form-control-sm" value="@Model.BorsaSicilNo" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.BorsaSicilNo)</span>
                </div>
            </div>
            @*             <div class="row">
        <label asp-for="Filtre" class="col-sm-3 col-form-label pb-0"></label>
        <div class="col-sm-9">
        <input asp-for="Filtre" class="form-control form-control-sm" />
        <span class="text-danger">@Html.ValidationMessageFor(model => model.Filtre)</span>
        </div>
        </div> *@
            <div class="row">
                <label for="PlakaNo" class="col-sm-3 col-form-label pb-0">Plaka No</label>
                <div class="col-sm-9">
                    <input name="PlakaNo" id="PlakaNo" class="form-control form-control-sm" value="@Model.PlakaNo" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.PlakaNo)</span>
                </div>
            </div>
            <div class="row">
                <label for="Devir" class="col-sm-3 col-form-label pb-0">Devir</label>
                <div class="col-sm-9">
                    <input type="text" data-type="num" name="Devir" id="Devir" class="form-control form-control-sm" value="@Model.Devir.ToString()" />
                    <span class="text-danger">@Html.ValidationMessageFor(model => model.Devir)</span>
                </div>
            </div>
            <div class="row">
                <label class="col-sm-5 col-form-label pb-0" for="GibEFaturaPostaKutusuId">E-Fatura Posta Kutusu</label>
                <div class="col-sm-7">
                    <select class="form-select form-select-sm" id="GibEFaturaPostaKutusuId" name="GibEFaturaPostaKutusuId">
                        @if (ViewBag.efaturaPostalar != null)
                        {
                            foreach (var item in ViewBag.efaturaPostalar as SelectList)
                            {
                                <option value="@item.Value" @(Model.GibEFaturaPostaKutusuId == int.Parse(item.Value) ? "selected" : "")>@item.Text</option>
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="RusumAlinmasin" name="RusumAlinmasin" value="true" @(Model.RusumAlinmasin == true ? "checked" : "")>
                        <label class="form-check-label" for="RusumAlinmasin">Rüsum Alınmasın</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="HalKomisyoncusu" name="HalKomisyoncusu" value="true" @(Model.HalKomisyoncusu == true ? "checked" : "")>
                        <label class="form-check-label" for="HalKomisyoncusu">Hal Komisyoncu</label>
                    </div>
                </div>
            </div>
            @*             <div class="row">
        <label asp-for="Vade" class="col-sm-3 col-form-label pb-0"></label>
        <div class="col-sm-9">
        <div class="input-group">
        <input type="number" data-type="num" asp-for="Vade" id="Vade" name="Vade" class="form-control form-control-sm" style="width: 180px;" max="3">
        <select class="form-control form-control-sm">
        <option value="hafta">Hafta</option>
        <option value="gun">Gün</option>
        <option value="ay">Ay</option>
        </select>
        </div>
        </div>
        </div> *@
        </div>
            @*  <div class="col-lg-4">
                   <div class="row">
            <label asp-for="FiyatListesiId" class="col-sm-5 col-form-label pb-0"></label>
            <div class="col-sm-7">
            <select class="form-select form-select-sm" asp-for="FiyatListesiId" id="FiyatListesiId" name="FiyatListesiId"  asp-items="ViewBag.fiyatlar">
            <option></option>
            </select>
            </div>
            </div>

        </div>*@
        </div>
    <div class="row">
        <div class="col">
            <input type="submit" value="Kaydet" class="btn btn-primary" style="text-align: center;" />
        </div>
    </div>
</form>
<div class="modal fade" id="modal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="modalLabel"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <div class="modal-body">
                <div id="modalContent"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Kapat
                </button>
                <button id="modalSaveBtn" type="button" class="btn btn-primary">
                    Kaydet
                </button>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script src="~/assets/customscripts/sharedfuncs.js"></script>
    <script>
        var maxLength = 10;
        var uyari = @Html.Raw(Json.Encode(ViewBag.resultText));
        if (uyari != null && uyari.message?.length > 0) {
            ShowAlert(uyari.state, uyari.message);
        }
        var il = $("#il");
        var ilce = $("#ilce");
        var belde = $("#belde");
        // var hal = $("#hal").parent().parent().css("display", "none");
        var ilBtn = $("#ilBtn");
        var ilceBtn = $("#ilceBtn");
        var beldeBtn = $("#beldeBtn");

        $(ilce).val() ? $(ilce).prop("disabled", false) : null;
        $(ilce).val() ? $(ilceBtn).prop("disabled", false) : null;

        $(belde).val() ? $(belde).prop("disabled", false) : null;
        $(belde).val() ? $(beldeBtn).prop("disabled", false) : null;

        var target = "";
        $(document).on("show.bs.modal", "#modal", function (e) {
            var btn = $(e.relatedTarget);
            var container = $("#modalContent");
            var label = $("#modalLabel");

            container.empty();
            label.empty();

            var ilDataId = document.getElementById("il").getAttribute("data-id");
            var ilceDataId = document.getElementById("ilce").getAttribute("data-id");

            if (btn.data("remote-url")) {
                target = btn.data("btarget");
                switch (target) {
                    case "ilce": ilDataId > 0 ? container.load(btn.data("remote-url") + `&ustId=${ilDataId}`) : null; break;
                    case "belde": ilceDataId > 0 ? container.load(btn.data("remote-url") + `&ustId=${ilceDataId}`) : null; break;
                    default: container.load(btn.data("remote-url")); break;
                }
                label.text(btn.data("label"))
            } else {
                target = e.relatedTarget.target;
            }

        });

        $(document).on("hidden.bs.modal", "#modal", function (e) {
            $("#modalContent").empty();
            $("#modalLabel").empty();
            switch (target) {
                case "il": if (document.getElementById("il").getAttribute("data-id") > 0) enableDisableFields(true, false, false, false, false, $("#IlId"), document.getElementById("il").getAttribute("data-id"), ilce); break;
                case "ilce": if (document.getElementById("ilce").getAttribute("data-id") > 0) enableDisableFields(true, true, true, false, false, $("#IlceId"), document.getElementById("ilce").getAttribute("data-id"), belde); break;
                case "belde": if (document.getElementById("belde").getAttribute("data-id") > 0) enableDisableFields(true, true, true, true, true, $("#BeldeId"), document.getElementById("belde").getAttribute("data-id"), null); break;
                case "vergidairesiid": document.getElementById("hidVergiDairesiId").getAttribute("data-id") > 0 ? $("#VergiDairesiId").val(document.getElementById("hidVergiDairesiId").getAttribute("data-id")) : $("#VergiDairesiId").val(null); break;
                case "postakoduid": document.getElementById("hidPostaKoduId").getAttribute("data-id") > 0 ? $("#PostaKoduId").val(document.getElementById("hidPostaKoduId").getAttribute("data-id")) : $("#PostaKoduId").val(null); break;
                case "arabtn":
                    sessionStorage.getItem('cariKartId') > 0 ? window.location.href = `/TohalCariKarts/Edit/${sessionStorage.getItem('cariKartId')}` : null;
                    sessionStorage.removeItem("cariKartId");
                    break;
            }
        });

        var oranInput = document.getElementById("Oran");
        document.getElementById("oranCheck").addEventListener("change", function () {
            oranInput.disabled = !this.checked;
        });
        var reoranInput = document.getElementById("ReeskontOrani");
        document.getElementById("reoranCheck").addEventListener("change", function () {
            reoranInput.disabled = !this.checked;
        });

        // document.getElementById('Vade').addEventListener('input', function () {
        //     if (this.value.length > 3) {
        //         this.value = this.value.slice(0, 3);
        //     }
        // });
        il.on("focusout", async function (e) {
            var res = await getData($(this), "/Common/ilGetir?isInput=True&target=il", "Ad", "YerId", e, null, "il");
            res.result ? enableDisableFields(true, false, false, false, false, $("#IlId"), res.data.YerId, ilce) : enableDisableFields(false, false, false, false, false, $("#IlId"), null, null);//il varsa ilce kutucugu aktif olacak ve değeri olmayacak diger kutucuklar pasif, //il yoksa hepsi pasif olacak
        });
        ilce.on("focusout", async function (e) {
            var res = await getData($(this), "/Common/ilceGetir?isInput=True&target=ilce", "Ad", "YerId", e, document.getElementById("il").getAttribute("data-id"), "ilce");
            res.result ? enableDisableFields(true, true, true, false, false, $("#IlceId"), res.data.YerId, belde) : enableDisableFields(true, true, false, false, false, $("#IlceId"), null, null);// ilce varsa belde alanı aktif hal alanı pasif olacak : // ilce yoksa belde ve hal pasif
        });
        belde.on("focusout", async function (e) {
            var res = await getData($(this), "/Common/ilceGetir?isInput=True&target=belde", "Ad", "YerId", e, document.getElementById("ilce").getAttribute("data-id"), "belde");
            res.result ? enableDisableFields(true, true, true, true, true, $("#BeldeId"), res.data.YerId, null) : enableDisableFields(true, true, true, true, false, $("#BeldeId"), null, null);
        });
        function enableDisableFields(ilc, ilcVal, beld, beldVal, hl, hiddenYerElm, hiddenYerVal, focusEl) {
            $(ilce).prop("disabled", !ilc);
            $(ilceBtn).prop("disabled", !ilc);
            ilcVal ? null : $(ilce).val(null);
            ilcVal ? null : $("#IlceId").val(null);

            $(belde).prop("disabled", !beld);
            $(beldeBtn).prop("disabled", !beld);
            beldVal ? null : $(belde).val(null);
            beldVal ? null : $("#BeldeId").val(null);

            setTimeout(function () {
                focusEl ? focusEl.focus() : null;
            });

            $(hiddenYerElm).val(hiddenYerVal);
            // hl ? $(hal).css("display", "block") : $(hal).css("display", "none");
        }
        $("#hidVergiDairesiId").on("focusout", async function (e) {
            var val = await getData($(this), "/Common/maddeGetir?isInput=True&target=hidVergiDairesiId&tur=2", "Ad", "TabloMaddesiId", e, null, "vergidairesiid");
            val.result ? $("#VergiDairesiId").val(val.data.TabloMaddesiId) : $("#VergiDairesiId").val(null);
        });
        $("#hidPostaKoduId").on("focusout", async function (e) {
            var val = await getData($(this), "/Common/maddeGetir?isInput=True&target=hidPostaKoduId&tur=0", "Ad", "TabloMaddesiId", e, null, "postakoduid");
            val.result ? $("#PostaKoduId").val(val.data.TabloMaddesiId) : $("#PostaKoduId").val(null);
        });
        $("#navigatorSaveBtn").click(function () {
            $("form").first().trigger("submit");
        });
        $("#hideRemoveBtn").click(function () {
            DeleteConfirm().then(p => {
                if (p.isConfirmed) {
                    var id = $('#CariKartId').val();
                    window.location.href = `/TohalCariKarts/Delete?cariKartId=${id}&kullaniciId=${0}&tip=${0}`
                }
            });
        });
        $("#recordDeleteBtn").click(function () {
            $("#hideRemoveBtn").trigger("click");
        });

        document.getElementById("gibKullaniciAlButton").addEventListener("click", function() {
            var tcVknValue = "@Model.VergiKimlikNo";

            $.ajax({
                type: "GET",
                url: "/TohalCariKarts/GibKullaniciAl",
                data: { tcVkn: tcVknValue},
                success: function (result) {
                    // Select'i temizle
                    $('#GibEFaturaPostaKutusuId').empty();

                    // Yeni seçenekleri ekleyin
                    if (result.efaturaPostalar != null) {
                        $.each(result.efaturaPostalar, function (index, item) {
                            $('#GibEFaturaPostaKutusuId').append('<option value="' + item.Value + '">' + item.Text + '</option>');

                        });
                    }
                    ShowAlert(true, "İşlem Başarılı");
                },
                error: function (error) {

                    ShowAlert(false, "Kayıt Bulunamadı " + error);
                }
            });
        });

        function handleKisilikTipiChange() {
            var kisilikTipi = document.getElementById("KisilikTipi").value;
            var vergiKimlikNoInput = document.getElementById("VergiKimlikNo");

            if (kisilikTipi == 2) {
                maxLength = 10;
            }
            else {
                maxLength = 11;
            }        
        }

        function handleCharacterCount() {
            var characterCount = document.getElementById("VergiKimlikNo").value.length;
            if (characterCount > maxLength) {
                document.getElementById("VergiKimlikNo").value = document.getElementById("VergiKimlikNo").value.slice(0, maxLength);
            }
        }
        document.addEventListener('DOMContentLoaded', function () {
            handleKisilikTipiChange()
            handleCharacterCount();
        });
    </script>
    @Html.Partial("_ValidationScriptsPartial")
}
