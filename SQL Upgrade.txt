--Tables
ALTER TABLE TOHAL_CARI_KART
	ADD [STOPAJSIZ_KESEBILIR] [BOOL] NULL
GO

ALTER TABLE TOHAL_CARI_SIFAT
	ADD [Id] [int] IDENTITY(1,1) NOT NULL
GO

ALTER TABLE TOHAL_ISKELE_EVRAK_MASRAFI
	ADD [ID] [int] IDENTITY(1,1) NOT NULL
GO

ALTER TABLE TOHAL_ISKELE_MAKBUZ_SATIRI
	ADD [ID] [int] IDENTITY(1,1) NOT NULL
GO

ALTER TABLE TOHAL_ISKELE_STOK_HAREKETI
	ADD [ID] [int] IDENTITY(1,1) NOT NULL
GO

ALTER TABLE TOHAL_STOK_HAREKETI
	ADD [GUID] [dbo].[GUID] NULL
GO

ALTER TABLE TOHAL_FATURA
	ADD [E_FATURA_SENARYOSU] [TUR] NULL
GO

ALTER TABLE TOHAL_TANIM
	ADD [FIR_E_ARSIV_FATURASI_GONDERILSIN] [BOOL] NULL
GO

ALTER TABLE TOHAL_TANIM
	ADD [E_FATURA_EXE_YOLU] [TANIM_ADI] NULL
GO

ALTER TABLE TOHAL_TANIM
	ADD [E_FATURA_PORTAL_ADRESI] [TANIM_ADI] NULL
GO

ALTER TABLE TOHAL_YAZICI
	ADD [AMBAR_NAVLUN_FATURASI_SIRA_NO] [TAMSAYI] NULL
GO

ALTER TABLE TOHAL_YAZICI
	ADD [SAT_FATURA_BELGESI] [dbo].[TUR] NULL
GO

ALTER TABLE TOHKS_KAYITLI_KUNYE_LISTESI
    ADD [ID] [int] IDENTITY(1,1) NOT NULL
GO

--Stored Procedures
IF OBJECT_ID('p_GetYer', 'P') IS NOT NULL
DROP PROCEDURE p_GetYer
GO

CREATE PROCEDURE [dbo].[p_GetYer]
@YerId int
AS
;WITH Parent AS
(
	SELECT *,YER_ID as top_hierarchy,0 as level
		FROM TOHAL_YER WHERE YER_ID=@YerId
	UNION ALL
	SELECT emp.*, parent.top_hierarchy, level+1
		FROM TOHAL_YER emp JOIN Parent ON emp.YER_ID = Parent.UST_ID
)
select YER_ID AS Id,UST_ID AS ParentId,TUR AS Type,AD Name,HKS_ID AS HksId from parent
GO

UPDATE TOHAL_TANIM SET DIG_SICIL_KODU = ''
GO

IF((SELECT COUNT(0) FROM TOHAL_NUMERATOR)<3)
BEGIN
	INSERT INTO TOHAL_NUMERATOR(TUR, ONEK, BASLANGIC, BITIS, UZUNLUK, ONUNE_SIFIR_KOY)VALUES (0, 'XXXA', 1, 1000000, 6, 1)
	INSERT INTO TOHAL_NUMERATOR(TUR, ONEK, BASLANGIC, BITIS, UZUNLUK, ONUNE_SIFIR_KOY)VALUES (1, 'XXXB', 1, 1000000, 6, 1)
	INSERT INTO TOHAL_NUMERATOR(TUR, ONEK, BASLANGIC, BITIS, UZUNLUK, ONUNE_SIFIR_KOY)VALUES (2, 'XXXC', 1, 1000000, 6, 1)
END
GO
